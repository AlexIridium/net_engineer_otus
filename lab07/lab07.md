# Лабораторная работа. Развертывание коммутируемой сети с резервными каналами

### 	Топология

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic00.JPG)


### 	Таблица адресации

| Устройство | Интерфейс | IP-адрес | Маска подсети |
| --- | --- | --- | --- |
| S1 | VLAN 1 | 192.168.1.1 | 255.255.255.0 |
| S2 | VLAN 1 | 192.168.1.2 | 255.255.255.0 |
| S3 | VLAN 1 | 192.168.1.3 | 255.255.255.0 |

# 	Цели

#### Часть 1. Создание сети и настройка основных параметров устройства


#### Часть 2. Выбор корневого моста


#### Часть 3. Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов


#### Часть 4. Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов


### Часть 1:	Создание сети и настройка основных параметров устройства

В этой части необходимо настроить топологию сети и основные параметры маршрутизаторов.

#### Шаг 1:	Создайте сеть согласно топологии:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic01.JPG)


#### Шаг 2:	Выполните инициализацию и перезагрузку коммутаторов:


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic02.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic03.JPG)


#### Шаг 3:	Настройте базовые параметры каждого коммутатора.

Выполнены следующие операции:

a.	Отключите поиск DNS.

b.	Присвойте имена устройствам в соответствии с топологией.

c.	Назначьте class в качестве зашифрованного пароля доступа к привилегированному режиму.

d.	Назначьте cisco в качестве паролей консоли и VTY и активируйте вход для консоли и VTY каналов.

e.	Настройте logging synchronous для консольного канала.

f.	Настройте баннерное сообщение дня (MOTD) для предупреждения пользователей о запрете несанкционированного доступа.

g.	Задайте IP-адрес, указанный в таблице адресации для VLAN 1 на всех коммутаторах.

h.	Скопируйте текущую конфигурацию в файл загрузочной конфигурации.

Для коммутатора S1 :

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic04.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic05.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic06.JPG)


Для коммутатора S2 :

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic07.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic08.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic09.JPG)


Для коммутатора S3 :

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic10.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic11.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic12.JPG)



#### Шаг 4:	Проверьте связь.

Проверьте способность компьютеров обмениваться эхо-запросами. Скрин ниже.

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2?	

*успешно*

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3?	

*успешно*

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3?	

*успешно*


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic13.JPG)


### Часть 2:	Определение корневого моста

Для каждого экземпляра протокола spanning-tree (коммутируемая сеть LAN или широковещательный домен) существует коммутатор, выделенный в качестве корневого моста. Корневой мост служит точкой привязки для всех расчётов протокола spanning-tree, позволяя определить избыточные пути, которые следует заблокировать.
Процесс выбора определяет, какой из коммутаторов станет корневым мостом. Коммутатор с наименьшим значением идентификатора моста (BID) становится корневым мостом. Идентификатор BID состоит из значения приоритета моста, расширенного идентификатора системы и MAC-адреса коммутатора. Значение приоритета может находиться в диапазоне от 0 до 65535 с шагом 4096. По умолчанию используется значение 32768

#### Шаг 1:	Отключите все порты на коммутаторах.

#### Шаг 2:	Настройте подключенные порты в качестве транковых.

Шаг 1 и Шаг 2 выполнены для S1:


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic14.JPG)

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic15.JPG)

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic16.JPG)

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic17.JPG)


Шаг 1 и Шаг 2 выполнены для S2:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic18.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic19.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic20.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic21.JPG)



Шаг 1 и Шаг 2 выполнены для S3:


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic22.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic23.JPG)


![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic24.JPG)



#### Шаг 3:	Включите порты F0/2 и F0/4 на всех коммутаторах.

Для S1:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic25.JPG)


Для S2:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic26.JPG)

Для S3:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic27.JPG)


#### Шаг 4:	Отобразите данные протокола spanning-tree.

Введите команду show spanning-tree на всех трех коммутаторах. Приоритет идентификатора моста рассчитывается путем сложения значений приоритета и расширенного идентификатора системы. Расширенным идентификатором системы всегда является номер сети VLAN. В примере ниже все три коммутатора имеют равные значения приоритета идентификатора моста (32769 = 32768 + 1, где приоритет по умолчанию = 32768, номер сети VLAN = 1); следовательно, коммутатор с самым низким значением MAC-адреса становится корневым мостом (в моем случае — S2).


*show spanning-tree* для S1:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic28.JPG)


*show spanning-tree* для S2:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic29.JPG)


*show spanning-tree* для S3:

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic30.JPG)



Примечание. Режим STP по умолчанию на коммутаторе 2960 — протокол STP для каждой сети VLAN (PVST).


В схему ниже запишите роль и состояние (Sts) активных портов на каждом коммутаторе в топологии.

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic31.JPG)


#### Вопросы и ответы:

Какой коммутатор является корневым мостом?

*Коммутатор S2*

Почему этот коммутатор был выбран протоколом spanning-tree в качестве корневого моста?

*Так как коммутатор S2 с самым низким значением MAC-адреса*

Какие порты на коммутаторе являются корневыми портами?

*согласно скрина выше, корневых портов на S2 нет* 

Какие порты на коммутаторе являются назначенными портами? 

*Порты Fa0/2 , Fa0/4 назначенные порты*

Какой порт отображается в качестве альтернативного и в настоящее время заблокирован? 

*Порт Fa0/4 на коммутаторе S3*

Почему протокол spanning-tree выбрал этот порт в качестве невыделенного (заблокированного) порта?

*Протокол STP определяет назначенный и альтернативный порь, при это альтернативный порт блокируется, чтобы в наличии имелся только один путь по коммутируемой сети*


### Часть 3:	Наблюдение за процессом выбора протоколом STP порта, исходя из стоимости портов.

Алгоритм протокола spanning-tree (STA) использует корневой мост как точку привязки, после чего определяет, какие порты будут заблокированы, исходя из стоимости пути. Порт с более низкой стоимостью пути является предпочтительным. Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Наиболее низкие значения являются предпочтительными. В части 3 вам предстоит изменить стоимость порта, чтобы определить, какой порт будет заблокирован протоколом spanning-tree.

#### Шаг 1:	Определите коммутатор с заблокированным портом.

При текущей конфигурации только один коммутатор может содержать заблокированный протоколом STP порт. Выполните команду show spanning-tree на обоих коммутаторах некорневого моста. В примере ниже протокол spanning-tree блокирует порт F0/4 на коммутаторе с самым высоким идентификатором BID (S3).

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic32.JPG)

##### Шаг 2:	Измените стоимость порта.

Помимо заблокированного порта, единственным активным портом на этом коммутаторе является порт, выделенный в качестве порта корневого моста. Уменьшите стоимость этого порта корневого моста до 18, выполнив команду spanning-tree vlan 1 cost 18 режима конфигурации интерфейса.

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic34.JPG)

#### Шаг 3:	Просмотрите изменения протокола spanning-tree.

Повторно выполните команду show spanning-tree на обоих коммутаторах некорневого моста. Заблокированный порт (S3 – F0/4) теперь является назначенным портом, и протокол spanning-tree теперь блокирует порт на другом коммутаторе некорневого моста (S1 – F0/4).

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic33.JPG)

Почему протокол spanning-tree заменяет ранее заблокированный порт на назначенный порт и блокирует порт, который был назначенным портом на другом коммутаторе? 

*Так как мы уменьшили стоимость этого порта корневого моста*


#### Шаг 4:	Удалите изменения стоимости порта.

a.	Выполните команду no spanning-tree vlan 1 cost 18 режима конфигурации интерфейса, чтобы удалить запись стоимости, созданную ранее.

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic35.JPG)


b.	Повторно выполните команду show spanning-tree, чтобы подтвердить, что протокол STP сбросил порт на коммутаторе некорневого моста, вернув исходные настройки порта. Протоколу STP требуется примерно 30 секунд, чтобы завершить процесс перевода порта.

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic36.JPG)


### Часть 4:	Наблюдение за процессом выбора протоколом STP порта, исходя из приоритета портов

Если стоимости портов равны, процесс сравнивает BID. Если BID равны, для определения корневого моста используются приоритеты портов. Значение приоритета по умолчанию — 128. STP объединяет приоритет порта с номером порта, чтобы разорвать связи. Наиболее низкие значения являются предпочтительными. В части 4 вам предстоит активировать избыточные пути до каждого из коммутаторов, чтобы просмотреть, каким образом протокол STP выбирает порт с учетом приоритета портов

a.	Включены порты F0/1 и F0/3 на всех коммутаторах:

b.	Протокол STP завершил процесс перевода порта. Порт корневого моста переместился на порт с меньшим номером, связанный с коммутатором корневого моста, и заблокировал предыдущий порт корневого моста

![](https://github.com/AlexIridium/net_engineer_otus/blob/main/lab07/pic37.JPG)


Какой порт выбран протоколом STP в качестве порта корневого моста на каждом коммутаторе некорневого моста?

*В качестве корневого моста выбран порт Fa0/1  на коммутаторе S1 и также порт Fa0/1  на коммутаторе S2*

Почему протокол STP выбрал эти порты в качестве портов корневого моста на этих коммутаторах?

*Протокол STP сравнил стоимости портов, затем сравнивал BID и выбрал наиболее низкие значения.*


### Вопросы для повторения

1.	Какое значение протокол STP использует первым после выбора корневого моста, чтобы определить выбор порта?

*стоимость корневого пути*

2.	Если первое значение на двух портах одинаково, какое следующее значение будет использовать протокол STP при выборе порта?

*значение приоритета моста*

3.	Если оба значения на двух портах равны, каким будет следующее значение, которое использует протокол STP при выборе порта?

*самый низкий MAC-адрес*


















